import me from"process";var ie=import.meta.url;var ae=(e,t)=>new Error(`invalid moduleId: "${e}" (used by ${t})`),le=(e,t)=>new Error(`un-mocked moduleId: "${e}" (used by ${t})`),ue=()=>new Error("the loader chain process must include esmock. start the process using --loader=esmock."),m={errModuleIdNotFound:ae,errModuleIdNotMocked:le,errMissingLoader:ue};var[F,de]=me.versions.node.split(".").map(e=>+e),nt=F<16||F===16&&de<12;var pe="esmock-loader=true",fe=e=>`${e}?${pe}`,A=async e=>(await import(fe(e))).default===!0;var N=(e=>async()=>e||(e=await A(import.meta.url)))();import De from"fs";import Pe from"node:url";import V from"fs";import W from"url";import i from"path";import L from"module";var x=L.createRequire(import.meta.url),G=V.realpathSync.native,_=new RegExp("^(?:node:)?("+L.builtinModules.join("|").replace("/","/")+")$"),ge=/^\.?\.?([a-zA-Z]:)?(\/|\\)/,w=/^.\.?(?=\/|\\)/,D=/\\/g,he=/index.[tj]sx?$/,je=/[\\/]resolvewithplus[\\/]/,ye=/(^@[^/]*\/[^/]*|^[^/]*)\/?(.*)$/,b=/^#/,B=/(\*)/g,Z=/([./])/g,be=/^node:/,Ie=/^file:/,q=[".js",".mjs",".ts",".tsx",".json",".node"],P="node_modules",j="package.json",K="node",z="default",R="import",h=".",H=e=>e&&typeof e=="object",I={},Me=e=>be.test(e)?e:`node:${e}`,xe=e=>e&&W.pathToFileURL(e).href,we=e=>_.test(e),Re=e=>Ie.test(e)?W.fileURLToPath(e):e,$e=e=>i.resolve(i.extname(e)?i.dirname(e):e)+"/",M=e=>D.test(e)?e.replace(D,i.posix.sep):e,d=(e,t)=>{try{t=V.statSync(e)}catch{t=!1}return t&&(t.isFile()||t.isFIFO())},Q=e=>e.split(i.sep).slice(1).reduce((t,s,o)=>(s===P&&!je.test(e)||(s=i.resolve(i.join(o?t[0][o-1]:i.sep,s)),t[0].push(s),t[1].push(i.join(s,P))),t),[[],[]])[1].reverse(),Se=e=>{let t=e.split(i.sep).slice(1).reduce((s,o,r)=>(s.push(i.resolve(i.join(r?s[r-1]:i.sep,o))),s),[]).reverse().find(s=>d(i.join(s,j)));return t&&i.join(t,j)},Ee=e=>(String(e).match(ye)||[]).slice(1),U=(e,t)=>new RegExp(e.replace(Z,"\\$1").replace(B,".*")).test(t),Oe=(e,t,s)=>{let o=new RegExp(e.replace(Z,"\\$1").replace(B,"(.*)")),r=(s.match(o)||[])[1];return r&&t.replace("*",r)},J=(e,t,s,o=!1)=>(U(e,s)&&(t.includes("*")?U(t,s)?o=s:e.includes("*")&&e!==t&&(o=Oe(e,t,s)):o=t),o),X=(e,t,s,o=e[0])=>e.length?(b.test(s)?b.test(o):w.test(o))&&typeof t[o]=="string"&&J(o,t[o],s)||X(e.slice(1),t,s):null,l=(e,t)=>{let s=!1;return typeof e=="string"?e:(!s&&Array.isArray(e)&&(s=e.reduce((o,r)=>o||l(r,t),null)),!s&&H(e)&&(typeof e[t]=="string"&&(s=e[t]),!s&&e[K]&&(s=l(e[K],t)),!s&&e[z]&&(s=l(e[z],t)),!s&&e[t]&&(s=l(e[t],t)),!s&&e[h]&&(s=typeof e[h]=="string"?t===R&&l(e[h],t):l(e[h],t)),s||(s=X(Object.keys(e),e,t))),s)},Y=(e,t)=>{let s=t&&t.ismodule&&e.module,o=s||t&&t.browser&&e.browser,r=e.exports,c,n;return o&&(typeof o=="string"?n=o:H(o)&&([c]=Object.keys(o).filter(a=>he.test(a)),n=c in o&&o[c])),r&&(n=l(r,R)),n},f=e=>{var t=null;return d(e)?t=e:q.some(s=>d(e+s)&&(t=e+s)),t},ee=(e,t)=>{let s=null,o,r=i.join(e,j),c=d(r)&&x(r);return(o=Y(c,t))?s=f(i.join(e,o)):(o=c.main)?s=f(i.join(e,o))||f(i.join(e,i.join(o,"index"))):q.some(n=>(n=i.join(e,`index${n}`))&&d(n)&&(s=n)),s},te=(e,t,s)=>{let o=w.test(e)?i.join(t,e):e;return f(o,s)||ee(o,s)},ve=(e,t,s)=>{let o=s&&s.imports,r=l(o,t);return r&&(w.test(r)?i.join(e,r):se(r,e,{isposixpath:!0}))},Ce=(e,t,s,o)=>{let r=l(o&&o.exports,s?"./"+s:R);return r&&i.join(e,t,r)},Te=(e,t,s,o)=>{let r=i.join(e,t,j),c=d(r),n=c&&x(r);return c&&Ce(e,t,s,n,o)},Fe=(e,t,s)=>{let o=Se(t),r=i.dirname(o);return o&&ve(r,e,x(o),s)},Ae=(e,t,s)=>{let[o,r]=Ee(e);if(b.test(o))return Fe(e,t,s);let c=Q(t).sort((n,a)=>n.length>a.length);return function n(a,u,y=u-1){return u--?Te(i.join(a[y-u]),o,r,s)||te(i.join(a[y-u],e),null,s)||n(c,u,y):null}(c,c.length)},Ne=(e,t,s)=>{var o=null;return t=typeof t=="string"?$e(Re(decodeURI(t))):process.cwd(),_.test(e)?o=Me(e):(o=ge.test(e)?te(M(e),t,s):Ae(e,t),o=o&&(s.isposixpath?G(o):xe(M(G(o))))),o},se=(e,t,s)=>{let o=I[e+t];return o||(o=Ne(e,t,s||{}),I[e+t]=o)},k=Object.assign(se,{pathToPosix:M,getasnode_module_paths:Q,getesmkeyvalmatch:J,getasfilesync:f,getasdirsync:ee,gettargetindex:Y,iscoremodule:we,esmparse:l,cache:I});var $={isESM:{},mockDefs:{}},oe=(e,t)=>global.mockKeys[String(e)]=t,S=e=>global.mockKeys[String(e)],E=(e,t)=>global.esmockCache.mockDefs[e]=t,Ge=e=>global.esmockCache.mockDefs[e],re=e=>$.isESM[e],ne=(e,t)=>$.isESM[e]=t;Object.assign(global,{esmockCache:$,esmockCacheGet:Ge,esmockTreeIdGet:S,mockKeys:{}});var O=e=>typeof e=="object"&&e,v=e=>O(e)&&"default"in e,Ke=/^\.?\.?([a-zA-Z]:)?(\/|\\)/,ze=typeof import.meta.resolve=="function",Ue=((e=0)=>()=>++e)(),Ve=e=>e.startsWith("file://")?e:Pe.pathToFileURL(e),We=(e,t)=>O(e)&&O(t)?Object.assign({},e,t):t,Le=(e,t,s)=>(t=Object.assign({},e||{},{default:We(v(e)&&e.default,v(t)?t.default:t)},t),!k.iscoremodule(s)&&Object.isExtensible(t.default)&&(t.default.default=t.default),t),_e=/(^\s*|[});\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'()\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/,Be=(e,t)=>(t=re(e),typeof t=="boolean"||(t=!k.iscoremodule(e)&&Ke.test(e)&&_e.test(De.readFileSync(e,"utf-8")),ne(e,t)),t),Ze=(e,t)=>{let s=v(e)&&e.default;return/boolean|string|number/.test(typeof s)?e:Object.isExtensible(s)?Object.assign(s,e,{esmkTreeId:t}):Object.assign({},s,e,{esmkTreeId:t})},qe=e=>{let t=c=>c==="null"||E(c,null),s=S(e.split("esmk=")[1]),[o,r]=s.split("#-#esmkdefs=");String(r).split("#-#").forEach(t),String(o.split("esmkgdefs=")[1]).split("#-#").forEach(t)},He=async(e,t,s,o,r)=>{t=Le(r.strict||!o||await import(o),t,o);let c=(o||"file:///"+s)+"?"+["esmkTreeId="+e,"esmkModuleId="+s,"isfound="+Boolean(o),"isesm="+Be(o),"exportNames="+Object.keys(t).sort().join()].join("&");return E(c,t),c},C=async(e,t,s,o,r,c,n)=>{if(o=o||Object.keys(s),n=o[0],c=c||[],!n)return c;let a=ze?await import.meta.resolve(n,Ve(e)).catch(()=>null):k(n,e);if(!a&&r.isModuleNotFoundError!==!1)throw m.errModuleIdNotFound(n,e);return c.push(await He(t,s[n],n,a,r)),C(e,t,s,o.slice(1),r,c)},Qe=async(e,t,s,o,r)=>{let c=k(e,t);if(!c)throw m.errModuleIdNotFound(e,t);let n=typeof r.id=="number"?r.id:Ue(),a=`${c}?key=${n}&strict=${r.strict}?`+["esmkgdefs="+(o&&(await C(t,n,o,Object.keys(o),r)).join("#-#")||0),"esmkdefs=",s&&(await C(t,n,s,Object.keys(s),r)).join("#-#")||0].join("#-#");return oe(String(n),a),c+`?esmk=${n}`},g=Object.assign(Qe,{purge:qe,sanitize:Ze});var Je=/^.*(\(|at )(.*):[\d]*:[\d]*.*$/,ce=(e,t)=>(e=typeof e[1]=="string"?e:[e[0],new Error().stack.split(`
`)[3].replace(Je,"$2"),...e.slice(1)],e[4]={...e[4],...t},e);var p=e=>async(...t)=>{let[s,o,r,c,n]=ce(t,e);if(!await N())throw m.errMissingLoader();let a=await g(s,o,r,c,n),u=await import(a);return n.purge!==!1&&g.purge(a),g.sanitize(u,a)},T=e=>e&&/object|function/.test(typeof e)&&"esmkTreeId"in e&&g.purge(e.esmkTreeId),Xe=Object.assign(p({strict:1}),{purge:T,p:p({strict:1,purge:!1})}),Ye=Object.assign(p({strict:3}),{purge:T,p:p({strict:3,purge:!1})}),ke=Object.assign(p(),{purge:T,p:p({purge:!1}),strict:Xe,strictest:Ye});export{ke as default,Xe as strict,Ye as strictest};
